<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for keystone/lib/core/options.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">keystone/lib/core/</a> options.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">73.13% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>49/67</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">54.9% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>28/51</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">73.13% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>49/67</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">148×</span>
<span class="cline-any cline-yes">83×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">65×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">65×</span>
<span class="cline-any cline-yes">65×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var callerId = require('caller-id');
var cloudinary = require('cloudinary');
var path = require('path');
var url = require('url');
&nbsp;
/**
 * This file contains methods specific to dealing with Keystone's options.
 * All exports are added to the Keystone.prototype
 */
&nbsp;
// Determines if path is absolute or relative
function isAbsolutePath (value) {
	return path.resolve(value) === path.normalize(value).replace(new RegExp(path.sep + '$'), '');
}
&nbsp;
/**
 * Sets keystone options
 *
 * Example:
 *     keystone.set('user model', 'User') // sets the 'user model' option to `User`
 */
exports.set = function (key, value) {
&nbsp;
	if (arguments.length === 1) {
		return this._options[key];
	}
&nbsp;
	switch (key) {
		// throw on unsupported options
<span class="branch-0 cbranch-no" title="branch not covered" >		case 'email rules':</span>
<span class="cstat-no" title="statement not covered" >			throw new Error('The option "' + key + '" is no longer supported. See https://github.com/keystonejs/keystone/wiki/0.3.x-to-0.4.x-Changes');</span>
		// handle special settings
<span class="branch-1 cbranch-no" title="branch not covered" >		case 'cloudinary config':</span>
<span class="cstat-no" title="statement not covered" >			if (typeof value === 'string') {</span>
<span class="cstat-no" title="statement not covered" >				var parts = url.parse(value, true);</span>
<span class="cstat-no" title="statement not covered" >				var auth = parts.auth ? parts.auth.split(':') : [];</span>
<span class="cstat-no" title="statement not covered" >				value = {</span>
					cloud_name: parts.host,
					api_key: auth[0],
					api_secret: auth[1],
					private_cdn: parts.pathname != null,
					secure_distribution: parts.pathname &amp;&amp; parts.pathname.substring(1),
				};
			}
<span class="cstat-no" title="statement not covered" >			cloudinary.config(value);</span>
<span class="cstat-no" title="statement not covered" >			value = cloudinary.config();</span>
<span class="cstat-no" title="statement not covered" >			break;</span>
		case 'auth':
			<span class="missing-if-branch" title="else path not taken" >E</span>if (value === true &amp;&amp; !this.get('session')) {
				this.set('session', true);
			}
			break;
<span class="branch-3 cbranch-no" title="branch not covered" >		case 'nav':</span>
<span class="cstat-no" title="statement not covered" >			this.nav = this.initNav(value);</span>
<span class="cstat-no" title="statement not covered" >			break;</span>
<span class="branch-4 cbranch-no" title="branch not covered" >		case 'mongo':</span>
<span class="cstat-no" title="statement not covered" >			if (typeof value !== 'string') {</span>
<span class="cstat-no" title="statement not covered" >				if (Array.isArray(value) &amp;&amp; (value.length === 2 || value.length === 3)) {</span>
<span class="cstat-no" title="statement not covered" >					console.log('\nWarning: using an array for the `mongo` option has been deprecated.\nPlease use a mongodb connection string, e.g. mongodb://localhost/db_name instead.\n\n'</span>
					+ 'Support for arrays as the `mongo` setting will be removed in a future version.');
<span class="cstat-no" title="statement not covered" >					value = (value.length === 2) ? 'mongodb://' + value[0] + '/' + value[1] : 'mongodb://' + value[0] + ':' + value[2] + '/' + value[1];</span>
				} else {
<span class="cstat-no" title="statement not covered" >					console.error('\nInvalid Configuration:\nThe `mongo` option must be a mongodb connection string, e.g. mongodb://localhost/db_name\n');</span>
<span class="cstat-no" title="statement not covered" >					process.exit(1);</span>
				}
			}
<span class="cstat-no" title="statement not covered" >			break;</span>
		case 'module root':
			// if relative path is used, resolve it based on the caller's path
			if (!isAbsolutePath(value)) {
				var caller = callerId.getData();
				value = path.resolve(path.dirname(caller.filePath), value);
			}
			break;
		case 'app':
			this.app = value;
			break;
		case 'mongoose':
			this.mongoose = value;
			break;
		case 'frame guard':
			var validFrameGuardOptions = ['deny', 'sameorigin'];
&nbsp;
			if (value === true) {
				value = 'deny';
			}
			if (typeof value === 'string') {
				value = value.toLowerCase();
				if (validFrameGuardOptions.indexOf(value) &lt; 0) {
					value = false;
				}
			} else if (typeof value !== 'boolean') {
				value = false;
			}
			break;
	}
&nbsp;
	this._options[key] = value;
	return this;
};
&nbsp;
&nbsp;
/**
 * Sets multiple keystone options.
 *
 * Example:
 *     keystone.options({test: value}) // sets the 'test' option to `value`
 */
exports.options = function (options) {
	<span class="missing-if-branch" title="if path not taken" >I</span>if (!arguments.length) {
<span class="cstat-no" title="statement not covered" >		return this._options;</span>
	}
	if (typeof options === 'object') {
		var keys = Object.keys(options);
		var i = keys.length;
		var k;
		while (i--) {
			k = keys[i];
			this.set(k, options[k]);
		}
	}
	return this._options;
};
&nbsp;
&nbsp;
/**
 * Gets keystone options
 *
 * Example:
 *     keystone.get('test') // returns the 'test' value
 */
exports.get = exports.set;
&nbsp;
/**
 * Gets an expanded path option, expanded to include moduleRoot if it is relative
 *
 * Example:
 *     keystone.get('pathOption', 'defaultValue')
 */
exports.getPath = function (key, defaultValue) {
	return this.expandPath(this.get(key) || <span class="branch-1 cbranch-no" title="branch not covered" >defaultValue)</span>;
};
&nbsp;
/**
 * Expands a path to include moduleRoot if it is relative
 */
exports.expandPath = function (pathValue) {
	pathValue = (typeof pathValue === 'string' &amp;&amp; pathValue.substr(0, 1) !== path.sep &amp;&amp; pathValue.substr(1, 2) !== ':\\')
		? path.join(this.get('module root'), pathValue)
		: <span class="branch-1 cbranch-no" title="branch not covered" >pathValue;</span>
	return pathValue;
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Mar 24 2016 20:05:17 GMT+1100 (AEDT)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
